skills:
  # Core Extraction Skills
  - name: extract-file-implementation
    context: Document extraction from file paths
    key_source_files:
      - crates/kreuzberg-py/src/core.rs (extract_file, batch_extract_files)
      - crates/kreuzberg/src/core/extractor.rs (extract_file, extract_bytes)
    master_concepts:
      - Async extraction entry point
      - File reading and MIME detection
      - Extractor selection and execution
      - Cache integration
      - Error handling with fallback chains
    step_by_step: |
      1. Read file into memory (or stream for large files)
      2. Detect MIME type from extension/magic bytes
      3. Query extractor registry for matching extractors
      4. Select highest-priority extractor
      5. Execute extraction with ExtractionConfig
      6. Cache result using content hash
      7. Return ExtractionResult or error
    skills_involved:
      - async-rust-patterns
      - mime-type-detection
      - extractor-selection
      - error-handling
      - performance-optimization
    when_to_use: Extracting single documents with full async support

  - name: batch-extract-files
    context: Concurrent extraction of multiple documents
    key_source_files:
      - crates/kreuzberg-py/src/core.rs (batch_extract_files, batch_extract_bytes)
      - crates/kreuzberg/src/utils.rs (estimate_pool_size)
    master_concepts:
      - Concurrent execution with configurable pool size
      - Per-document error handling
      - Result ordering preservation
      - Worker pool management
      - Performance optimization
    step_by_step: |
      1. Estimate optimal worker pool size
      2. Create async task queue for documents
      3. Spawn worker tasks up to pool size
      4. Process documents concurrently
      5. Track errors per document
      6. Preserve input document ordering
      7. Return batch results
    skills_involved:
      - concurrency-patterns
      - tokio-runtime
      - worker-pools
      - batch-processing
      - error-aggregation
    when_to_use: Extracting multiple documents with performance optimization

  - name: cache-integration
    context: Optimize extraction with content-based caching
    key_source_files:
      - Cache implementation (location TBD)
      - Configuration in ExtractionConfig
    master_concepts:
      - Content hash generation
      - Cache key design
      - Cache validation
      - Cache invalidation on config change
      - Performance metrics
    step_by_step: |
      1. Compute content hash of file
      2. Generate cache key from hash
      3. Query cache for entry
      4. If cache hit, return cached result
      5. If cache miss, proceed with extraction
      6. Validate cache entry matches current config
      7. Store result with metadata
      8. Track cache statistics
    skills_involved:
      - hashing-algorithms
      - cache-design
      - performance-analysis
      - metadata-management
    when_to_use: Optimizing extraction performance for repeated documents

  - name: mime-detection-implementation
    context: Detect document formats reliably
    key_source_files:
      - crates/kreuzberg/src/core/mime.rs
    master_concepts:
      - Extension-based detection
      - Magic bytes detection
      - Content-based detection
      - Legacy format detection
      - Format conversion coordination
    step_by_step: |
      1. Check file extension
      2. Read magic bytes
      3. Match against known signatures
      4. Fall back to content analysis if ambiguous
      5. Detect legacy Office formats
      6. Coordinate format conversion if needed
      7. Return definitive MIME type
    skills_involved:
      - file-format-knowledge
      - binary-data-parsing
      - heuristic-detection
    when_to_use: Identifying document formats for routing to extractors

  - name: extractor-selection-and-fallback
    context: Route documents to appropriate extractors with fallback chains
    key_source_files:
      - Document extractor trait in plugins
      - Extractor registry implementation
    master_concepts:
      - Registry querying
      - Priority-based sorting
      - Fallback chain execution
      - Error context preservation
      - Batch operation resilience
    step_by_step: |
      1. Query registry for MIME type
      2. Get list of supporting extractors
      3. Sort by priority (highest first)
      4. For each extractor in order:
         a. Execute extraction
         b. On success, return result
         c. On failure, record error and continue
      5. If all fail, return aggregate error
      6. For batch: continue with next document
    skills_involved:
      - registry-patterns
      - priority-systems
      - fallback-chains
      - error-aggregation
    when_to_use: Routing documents and implementing resilient extraction

  # Configuration & Customization Skills
  - name: configuration-management
    context: Control extraction behavior through ExtractionConfig
    key_source_files:
      - crates/kreuzberg-py/src/config.rs
    master_concepts:
      - Config structure and hierarchy
      - Per-extractor config sections
      - Config validation
      - Config application to behavior
      - Config impact on output
    step_by_step: |
      1. Define ExtractionConfig with all options
      2. Document each config field
      3. Create config validators
      4. Apply config to extractor behavior
      5. Test config impact on results
      6. Provide config examples
      7. Document defaults
    skills_involved:
      - api-design
      - configuration-systems
      - validation-logic
      - testing-strategies
    when_to_use: Designing flexible extraction behavior through configuration

  - name: post-processor-integration
    context: Enhance extraction results through post-processors
    key_source_files:
      - Post-processor plugin trait
      - Post-processor registry
    master_concepts:
      - Post-processor chaining
      - Result modification
      - Selective plugin application
      - Error handling in chains
      - Result preservation
    step_by_step: |
      1. Get configured post-processors
      2. Sort by priority
      3. For each post-processor:
         a. Pass ExtractionResult
         b. Apply modifications
         c. Handle errors gracefully
      4. Return enhanced result
      5. Preserve original structure
    skills_involved:
      - plugin-composition
      - result-enhancement
      - error-handling
    when_to_use: Adding post-processing enhancements to extraction pipeline

  # Performance & Optimization Skills
  - name: performance-benchmarking
    context: Measure and optimize extraction performance
    key_source_files:
      - Benchmark harness (benchmarks/ directory)
    master_concepts:
      - Extract timing measurement
      - Cache hit rate analysis
      - Batch processing efficiency
      - Memory profiling
      - Trend analysis
    step_by_step: |
      1. Define performance baselines
      2. Create benchmark documents
      3. Measure extraction times
      4. Analyze results
      5. Identify bottlenecks
      6. Implement optimizations
      7. Verify improvements
      8. Track trends over time
    skills_involved:
      - performance-analysis
      - profiling-tools
      - statistical-analysis
    when_to_use: Optimizing extraction performance and tracking regressions

  - name: error-handling-and-recovery
    context: Implement robust error handling
    key_source_files:
      - crates/kreuzberg/src/error.rs
    master_concepts:
      - Error type classification
      - Error context preservation
      - Graceful degradation
      - User-friendly messages
      - Logging for debugging
    step_by_step: |
      1. Classify error types
      2. Capture error context
      3. Implement fallback strategies
      4. Generate helpful error messages
      5. Log detailed information
      6. Return structured errors
    skills_involved:
      - error-design
      - logging-strategies
      - user-experience
    when_to_use: Improving error handling and user experience

  # Testing & Validation Skills
  - name: extraction-quality-testing
    context: Test extraction output quality
    key_source_files:
      - tests/ directory
    master_concepts:
      - Extraction accuracy testing
      - Format-specific tests
      - Metadata validation
      - Table extraction testing
      - Image preservation testing
    step_by_step: |
      1. Create test documents
      2. Define expected outputs
      3. Run extraction
      4. Compare results
      5. Validate metadata
      6. Check table structure
      7. Verify images extracted
      8. Report results
    skills_involved:
      - test-design
      - assertion-frameworks
      - document-structure-knowledge
    when_to_use: Validating extraction quality for new features or formats

  - name: edge-case-handling
    context: Handle unusual document characteristics
    key_source_files:
      - tests/ directory with edge cases
    master_concepts:
      - Empty documents
      - Very large documents
      - Complex encodings
      - Unusual layouts
      - Corrupted/malformed documents
    step_by_step: |
      1. Identify edge cases
      2. Create test documents
      3. Test extraction behavior
      4. Implement handling logic
      5. Verify graceful handling
      6. Document limitations
    skills_involved:
      - edge-case-thinking
      - defensive-programming
      - error-handling
    when_to_use: Improving robustness and handling corner cases
