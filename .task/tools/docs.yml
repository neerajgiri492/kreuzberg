version: "3"

includes:
  _cfg:
    taskfile: ../config/vars.yml
    internal: true

tasks:
  build:
    desc: Build documentation
    cmds:
      - uv run mkdocs build --clean --strict

  serve:
    desc: Serve documentation locally
    cmds:
      - uv run mkdocs serve

  serve:versioned:
    desc: Serve versioned documentation with mike
    cmds:
      - uv run mike serve

  deploy:v4:
    desc: Deploy v4 documentation with mike
    cmds:
      - uv run mike deploy --update-aliases 4.0 latest
      - uv run mike set-default latest

  deploy:all:
    desc: Deploy v4 documentation
    cmds:
      - task: deploy:v4

  publish:
    desc: Publish documentation to GitHub Pages
    cmds:
      - uv run mike deploy --push 4.0 latest

  generate-readme:
    desc: Generate and format language package READMEs from templates
    cmds:
      - python3 scripts/generate_readme.py
      - mdformat packages/python/README.md packages/go/README.md packages/java/README.md packages/php/README.md packages/ruby/README.md packages/csharp/README.md packages/elixir/README.md crates/kreuzberg-node/README.md crates/kreuzberg-wasm/README.md

  generate-readme:check:
    desc: Validate READMEs match templates (CI mode)
    cmds:
      - python3 scripts/generate_readme.py --validate

  generate-readme:dry-run:
    desc: Preview README generation without writing files
    cmds:
      - python3 scripts/generate_readme.py --dry-run
